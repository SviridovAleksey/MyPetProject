{"ast":null,"code":"import { Cookie } from 'ng2-cookies';\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { Observable } from 'rxjs/Observable';\nimport 'rxjs/add/operator/catch';\nimport 'rxjs/add/operator/map';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport class Foo {\n  constructor(id, name) {\n    this.id = id;\n    this.name = name;\n  }\n\n}\nexport let AppService = /*#__PURE__*/(() => {\n  class AppService {\n    constructor(_http) {\n      this._http = _http;\n      this.clientId = 'newClient';\n      this.redirectUri = 'http://localhost:8095/';\n    }\n\n    retrieveToken(code) {\n      let params = new URLSearchParams();\n      params.append('grant_type', 'authorization_code');\n      params.append('client_id', this.clientId);\n      params.append('client_secret', 'newClientSecret');\n      params.append('redirect_uri', this.redirectUri);\n      params.append('code', code);\n      let headers = new HttpHeaders({\n        'Content-type': 'application/x-www-form-urlencoded; charset=utf-8'\n      });\n\n      this._http.post('http://localhost:8083/auth/realms/sviridov/protocol/openid-connect/token', params.toString(), {\n        headers: headers\n      }).subscribe(data => this.saveToken(data), err => err => alert('Invalid Credentials'));\n    }\n\n    updateTtoken() {\n      let params = new URLSearchParams();\n      params.append('grant_type', 'refresh_token');\n      params.append('refresh_token', Cookie.get('refresh_token'));\n      params.append('client_id', this.clientId);\n      params.append('client_secret', 'newClientSecret');\n      params.append('redirect_uri', this.redirectUri);\n      let headers = new HttpHeaders({\n        'Content-type': 'application/x-www-form-urlencoded; charset=utf-8'\n      });\n\n      this._http.post('http://localhost:8083/auth/realms/sviridov/protocol/openid-connect/token', params.toString(), {\n        headers: headers\n      }).subscribe(data => this.saveToken(data), err => alert('Invalid Update Token'));\n    }\n\n    saveToken(token) {\n      var expireDate = new Date().getTime() + 1000 * token.expires_in;\n      Cookie.set(\"access_token\", token.access_token, expireDate);\n      Cookie.set(\"id_token\", token.id_token, expireDate);\n      Cookie.set(\"refresh_token\", token.refresh_token);\n      console.log('Obtained Access token');\n      window.location.href = 'http://localhost:8095';\n    }\n\n    getResource(resourceUrl) {\n      var headers = new HttpHeaders({\n        'Content-type': 'application/x-www-form-urlencoded; charset=utf-8',\n        'Authorization': 'Bearer ' + Cookie.get('access_token')\n      });\n      return this._http.get(resourceUrl, {\n        headers\n      }).catch(e => {\n        if (e.status === 401 || e.status === 403) {\n          this.updateTtoken();\n        } else {\n          return Observable.throw(e.json().error || 'Server error');\n        }\n      });\n    }\n\n    checkCredentials() {\n      return Cookie.check('access_token');\n    }\n\n    logout() {\n      let token = Cookie.get('id_token');\n      Cookie.delete('access_token');\n      Cookie.delete('id_token');\n      Cookie.delete('refresh_token');\n      let logoutURL = \"http://localhost:8083/auth/realms/sviridov/protocol/openid-connect/logout?id_token_hint=\" + token + \"&post_logout_redirect_uri=\" + this.redirectUri;\n      window.location.href = logoutURL;\n    }\n\n  }\n\n  AppService.ɵfac = function AppService_Factory(t) {\n    return new (t || AppService)(i0.ɵɵinject(i1.HttpClient));\n  };\n\n  AppService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: AppService,\n    factory: AppService.ɵfac\n  });\n  return AppService;\n})();","map":null,"metadata":{},"sourceType":"module"}